  <!DOCTYPE html>
  <html>
    <head>
      <meta charset="utf-8">
      <title>Live Drawing</title>
    </head>
    <body>
      <div>Messages: <span id='messages'>0</span> &nbsp;, Online: <span id='clients'>1</span></div>
      <canvas id="myCanvas" width="1800" height="980" style="background: #000; margin-top:10px;"></canvas>
      <div>Source code &nbsp;<a href="https://github.com/sanhapon/drawing">https://github.com/sanhapon/drawing</a></div>

      <script>
         var ws = new WebSocket(`ws://${window.location.hostname}/ws`);

          ws.onmessage = function (evt) {
            const msg = JSON.parse(evt.data);
            console.log(msg);
            if (msg.msg_type === 'messages') {
              const mySpan = document.getElementById("messages");
              mySpan.textContent = msg.messages;
              if (msg.messages === 0) {
                const c = document.getElementById("myCanvas");
                const cv = c.getContext('2d');
                cv.clearRect(0,0,1800,980);
              }
            } else if (msg.msg_type === "line") {
              draw(msg.line);
            } else {
              const mySpan = document.getElementById("clients");
              mySpan.textContent = msg.messages;
            }
          };

          const c = document.getElementById("myCanvas");
          c.addEventListener("click", penTool);
          c.addEventListener("mousedown", setLastCoords);
          c.addEventListener("mousemove", freeForm);

          const ctx = c.getContext("2d");

          function setLastCoords(e) {
              const {x, y} = c.getBoundingClientRect();
              last_x = e.clientX - x;
              last_y = e.clientY - y;
          }

          function freeForm(e) {
              if (e.buttons !== 1) return;
              penTool(e);
          }

          function penTool(e) {
              const {x, y} = c.getBoundingClientRect();
              const new_x = e.clientX - x;
              const new_y = e.clientY - y;

              const line = {
                last_x,
                last_y,
                new_x,
                new_y
              };

              draw(line);
              ws.send(JSON.stringify(line));

              last_x = new_x;
              last_y = new_y;
          }

          function draw(line) {
              ctx.beginPath();
              ctx.lineWidth = 1;
              ctx.moveTo(line.last_x, line.last_y);
              ctx.lineTo(line.new_x, line.new_y);
              ctx.strokeStyle = 'white';
              ctx.stroke();
              ctx.closePath();
          }

          let last_x = 0;
          let last_y = 0;
      </script>
    </body>
  </html>